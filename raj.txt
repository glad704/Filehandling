!CPT FAULT!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! !PTCOI gives FC3! ! Command PTCOI returns Fault Code 3, Timeout in MAU or CPU ! Command PTCOE returns FAULT CODE 4, COMMAND NOT SUCCESSFULLY COMPLETED ! Fault initiated AP reboot in Node B ! PMC860 Group is 'Online' and wrongly with Passive node(NodeB) and not with Act ive Node (Node A) ! PMCrHW_1 and PMCrSDLC_1 resources are 'Online' but associated with the Passive Node (Node B) ! REMEDY: !CONDITIONS: !1.This solution is applicable to APG40. !2. A CPT FAULT alarm is present. !3. Command PTCOI and PTCOE gives the above Fault Codes. !4. AP Command ' Cluster Group ' shows that PMC860 Group is with the Passive No de. !PROCEDURE: !1. Login to the !Passive Node! using Administrative rights and !verify that the node is passive by using 'PRCSTATE' AP command. prcstate&HOSTNAME !2. Check hostname of the Passive node, use command 'HOSTNAME' AP command. !hostname ! mumbaihlr4b !3. Check that the Cluster Group PMC860 is with Passive node, use AP command 'Cl uster Group' cluster group !Ex:- C:\>cluster group !Listing status for all available resource groups: !Group Node Status !-------------------- --------------- -----!Disk Group mumbaihlr4a Online @PMC860 Group mumbaihlr4b Online !RGAPM_0 mumbaihlr4a Online !Cluster Group mumbaihlr4a Online !RGAPM_1 mumbaihlr4b Online !2. Reboot the Passive node by using 'PRCBOOT' AP command and confirm the comman d with 'yes or y' prcboot -f &exit !Ex:- C:\>prcboot !Do you want to REBOOT this node ? [y(es)/n(o)]:y !REBOOT INITIATED! !Wait for 7-10 minutes so that the Passive Node reboots correctly. !4. Login to the Passive Node and check that the Node is UP !and all the Cluster Resources are online. Use AP command 'cluster node' and 'cl uster res'. cluster node !Ex:- C:\>cluster node !Listing status for all available nodes: !Node Node ID Status !-------------- ------- --------------------!mumbaihlr4a 1 Up !mumbaihlr4b 2 Up cluster res | findstr -ive online !Ex:- C:\> cluster res | findstr -ive online !Listing status for all available resources: !Resource Group Node Status !-------------------- -------------------- --------------- ------

cluster group !3. Check that the Cluster Group PMC860 has now moved from Passive node to the A ctive node, use command 'Cluster Group' !Ex:- C:\>cluster group !Listing status for all available resource groups: !Group Node Status !-------------------- --------------- -----!Disk Group mumbaihlr4a Online @PMC860 Group mumbaihlr4a Online !RGAPM_0 mumbaihlr4a Online !Cluster Group mumbaihlr4a Online !RGAPM_1 mumbaihlr4b Online !4. Login to the Active Node and connect to CP using 'mml'. !Now try to do PTCOI/PTCOE, it should be successful this time. mml PTCOI; !Ex:- <ptcoi; !EXECUTED !cpt< PTWSP; !cpt<ptwsp; !CPT MESSAGE CP STATE !CP-A EX CP-B SBWO CON B: PHC:ACT !END PTCOE; !cpt<ptcoe; !EXECUTED exit; !PRIMUS SCS302172 !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! !Alarm: CPT FAULT ! This fault could be caused by a problem with either the CPT cables !or the CPT software in the APG. A bent pin in the MAU backplane has caused simi lar faults. ! REMEDY: !CONDITIONS: lzybura Eric1234 eaw BDANA IOEXP; !This solution is applicable to APG40 connected to an APZ 212 30 or 33. !Use this solution if the following occurs. !Example: !<PTCOI; !NOT ACCEPTED !FAULT CODE 2 !DATA LINK ERROR apamp; aploc; !PROCEDURE: phaprint swrprint CPTASPBIN !From the command "phaprint" entered at the c:\> prompt in the APG !For APZ 212 20/25, 30/33, !Name: MAS_CPTASP_Protocol !Level: Private Named Table: N/A

![Unsigned Int]: 0 !get IP address! ipconfig hostname&prcstate exit; exit; @set {active} = "10.246.3.17" @set {passive} = "10.246.3.18" ssh administrator@{active} admin123 hostname&prcstate cluster res |findstr /vie online hwver !Node A! ping 192.168.169.128 ping 192.168.170.128 exit !Node B! @set {passive} = "10.246.3.18" ssh administrator@{passive} admin123 hostname&prcstate ping 192.168.169.128 ping 192.168.170.128 exit @set {active} = "10.246.3.17" ssh administrator@{active} admin123 hostname&prcstate alist !Make sure that all relevant CPT resources are Online.! !AP Commands: ! cluster res PMCrHW_1 cluster res PMCrSDLC_1 cluster res MAS_CPTASP_cptcentral cluster res MAS_CPTASP_cptheartbeat exit !Node B! @set {passive} = "10.246.3.18" ssh administrator@{passive} admin123 hostname&prcstate cluster res PMCrHW_1 cluster res PMCrSDLC_1 cluster res MAS_CPTASP_cptcentral cluster res MAS_CPTASP_cptheartbeat exit !If any are Offline then they can be manually brought Online. !Then attempt PTCOI again. !AP Commands: @set {active} = "10.246.3.17" ssh administrator@{active} admin123

hostname&prcstate cluster res (resource) /online /wait mml PTCOI; PTCOE; allip; !Restart relevant CPT resources and make sure they return Online. Then attempt P TCOI again. !AP Commands: cluster res MAS_CPTASP_cptcentral /off /wait cluster res MAS_CPTASP_cptheartbeat /on /wait cluster res PMCrHW_1 /off /wait cluster res PMCrSDLC_1 /on /wait cluster res PMCrHW_1 cluster res PMCrSDLC_1 cluster res MAS_CPTASP_cptcentral cluster res MAS_CPTASP_cptheartbeat mml PTCOI; !Check CPT cable. A "Y" cable connects to each node of the APG40 - TSR 899 48/15 00. !This cable joins another cable TSR 899 34 which connects to the MAU. !If the Alarm "CPT FAULT" is present then follow the "CPT FAULT" ! OPI which will try replacing the MAU, check the MAU backplane for any bent pin .. !If the problem still exists then a reboot of the Active can be done. !This will make the other node Active. When the other node is active a ! different part of the CPT cable is used. Also the other nodes SDLC H/W !is used for CPT communication. !AP Command: prcboot -f &exit !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! !In our case we had APZ21233C with APG40 C/2 the CPT cable was ! connected with "Y" cable form AM-board towards the MAU. !REMEDY: !CONDITIONS: !This solution is applicable to APG40 C/2 connected to an ! APZ 212 30 or 33, towards SDLC protocol. !Use this solution if the following occurs. !And if SCS302172 didn't help to solve the issue. !Example: !<PTCOI; !NOT ACCEPTED !FAULT CODE 2 !DATA LINK ERROR !PROCEDURE: !1. We sawpped the "Y" cable between the two APG node to !determine if we have a cable fault.The problem was !stayed in the same node.What means we have problem with !one APG node.

!2. We made a power cycle for the faulty node to "reset" !the AM-board.After it the CPT was worked fine without any ! problem , for power cycle please follow solution of SCS479061

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! !This solution is applicable to APG40 and all CP types. phaprint !One or more of the following faults exist. !a. Alarm: CPT FAULT. !b. CP EVENT RECORD has ETYPE 600 INF1 H'0000 INF2 H'0001. !c. PTCOI returns FAULT CODE 2 DATA LINK ERROR. !The CPTASPBIN package installed is CXC 137 1057 !and/or CXC 137 1147/5 !If the CPTASPBIN package installed is CXC 137 1037 then follow SOLUTION (2). !AP Command: swrprint CPTASPBIN !The MAS_CPTASP_Protcol does not match the CP type and !CPT connection. !MAS_CPTASP_Protocol parameter values for CXC 137 1057. @ 0 for SDLC APZ 212 20, -25, -30, -33 ! 1 for TCP/IP APZ 212 33C. 30, 33 ! 2 for TCP/IP APZ 212 40 ! 3 for TCP/IP APZ 212 50 ! 4 for TCP/IP APZ 212 55 !Command: mml SAOSP; !AP Command: aploc; phaprint MAS_CPTASP_Protocol !The ACS_APCONFBIN_CpAndProtocolType does not match the ! CP type and CPT connection. !ACS_APCONFBIN_CpAndProtocolType parameter values for !CXC 137 1147. @ 0 for SDLC APZ 212 20, -25, -30, -33 ! 1 for TCP/IP APZ 212 33C. 30, 33 ! 2 for TCP/IP APZ 212 40 ! 3 for TCP/IP APZ 212 50 ! 4 for TCP/IP APZ 212 55 !Command: mml SAOSP; !AP Command: aploc; phaprint ACS_APCONFBIN_CpAndProtocolType !If the ACS_APCONFBIN_CpAndProtocolType parameter exists ! then follow SOLUTION (3). !PROCEDURE: !Perform a soft function change to set the correct value ! of the MAS_CPTASP_Protocol parameter. !Connect to the active node of the AP. !AP Command: prcstate !Execute a soft function change. !Use the soft function change setting to change the

!MAS_CPTASP_Protocol parameter in CPTASPBIN package. !AP Command: sfcexec !The example that follows is for the APZ 212 40. !For other APZ types the parameter needs to be set according to the table below: !MAS_CPTASP_Protocol parameter values for CXC 137 1057. ! 0 for SDLC APZ 212 20, -25, -30, -33 ! 1 for TCP/IP APZ 212 33C ! 2 for TCP/IP APZ 212 40 ! 3 for TCP/IP APZ 212 50 ! 4 for TCP/IP APZ 212 55 !Example: If the APZ type is APZ 212 50 use the value 2 rather than 3. !Example for APZ 212 40: !C:\> sfcexec !Soft Function Change Session !NOTE: The session can be aborted at any time before switch to !the new system has been ordered. Press Ctrl+C and ENTER to abort. !Would you like to copy parameter files from disk? [y(es)/n(o)]:n !Would you like to edit parameter files? [y(es)/n(o)]:y !Choose one of the packages to upgrade parameters in: !NO CXCNUMBER MODULENAME REVISION CNI !... !10 CXC1371057 CPTASPBIN R1H apz21220/5-1285 !... !Enter a number for the package to upgrade parameters in or !enter 'c(ontinue)' to continue soft function change session. !:10 !Parsing format file ... !Parsing parameter file ... !Parameter editing session started. !:edit MAS_CPTASP_Protocol !Category: Private !unsignedInt[0, 2] (0):2 !:print MAS_CPTASP_Protocol !Category: Private !unsignedInt[0, 2]: 2 !:end !Parameters updated !Exiting ... !Would you like to edit more parameter files? [y(es)/n(o)]:n !System upgrade performed. Would you like to switch to the new system, !thereby starting the supervision period? (No will abort and restore !the system. [y(es)/n(o)]:y !Parameter tables generated. No errors found. !Change of parameter(s) succeeded, supervision period has started. !Execute sfcend when supervision period is over. !Check that the MAS_CPTASP_Protocol parameter is now correct. !AP Command: phaprint MAS_CPTASP_Protocol !Example for APZ 212 40: !C:\> phaprint MAS_CPTASP_Protocol

!Name: MAS_CPTASP_Protocol !Level: Private Named Table: N/A ![Unsigned Int]: 2 !Check that CPT is now working. !Command: PTCOI; PTWSP; PTCOE; !End the soft function change. !AP Command: sfcend !SOLUTION 3!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! !The ACS_APCONFBIN_CpAndProtocolType does not match the ! CP type and CPT connection. !ACS_APCONFBIN_CpAndProtocolType parameter values for CXC 137 1147. @ 0 for SDLC APZ 212 20, -25, -30, -33 ! 1 for TCP/IP APZ 212 33C. 30, 33 ! 2 for TCP/IP APZ 212 40 ! 3 for TCP/IP APZ 212 50 ! 4 for TCP/IP APZ 212 55 !Command: mml SAOSP; !AP Command: phaprint ACS_APCONFBIN_CpAndProtocolType !PROCEDURE: !Perform a soft function change to set the correct value of the MAS_CPTASP_Proto col parameter. !Connect to the active node of the AP. !AP Command: prcstate !Execute a soft function change. !Use the soft function change setting to change the ! MAS_CPTASP_Protocol parameter in CPTASPBIN package. !AP Command: sfcexec !The example that follows is for the APZ 212 40. !For other APZ types the parameter needs to be set according to the table below: !ACS_APCONFBIN_CpAndProtocolType parameter values for CXC1371147. ! 0 for SDLC APZ 212 20, -25, -30, -33 ! 1 for TCP/IP APZ 212 33C ! 2 for TCP/IP APZ 212 40 ! 3 for TCP/IP APZ 212 50 ! 4 for TCP/IP APZ 212 55 !Example for APZ 212 40: !C:\> sfcexec !Soft Function Change Session !NOTE: The session can be aborted at any time before switch to !the new system has been ordered. Press Ctrl+C and ENTER to abort. !Would you like to copy parameter files from disk? [y(es)/n(o)]:n !Would you like to edit parameter files? [y(es)/n(o)]:y !Choose one of the packages to upgrade parameters in: !NO CXCNUMBER MODULENAME REVISION CNI !... !5 CXC1371147 APCONFBIN R1A ..... !...

!Enter a number for the package to upgrade parameters in or !enter 'c(ontinue)' to continue soft function change session. !:5 !Parsing format file ... !Parsing parameter file ... !Parameter editing session started. !:edit ACS_APCONFBIN_CpAndProtocolType !Category: Private !unsignedInt[0, 2] (0):2 !:print ACS_APCONFBIN_CpAndProtocolType !Category: Private !unsignedInt[0, 2]: 2 !:end !Parameters updated !Exiting ... !Would you like to edit more parameter files? [y(es)/n(o)]:n !System upgrade performed. Would you like to switch to the new system, !thereby starting the supervision period? (No will abort and restore !the system. [y(es)/n(o)]:y !Parameter tables generated. No errors found. !Change of parameter(s) succeeded, supervision period has started. !Execute sfcend when supervision period is over. !Check that the ACS_APCONFBIN_CpAndProtocolType parameter is now correct. !AP Command: phaprint ACS_APCONFBIN_CpAndProtocolType !Example for APZ 212 40: !C:\> phaprint ACS_APCONFBIN_CpAndProtocolType !Name: ACS_APCONFBIN_CpAndProtocolType !Level: Private Named Table: N/A ![Unsigned Int]: 2 !Check that CPT is now working. !Command: PTCOI; PTWSP; PTCOE; !End the soft function change. !AP Command: sfcend !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

